---
import Layout from '../../layouts/Layout.astro';
import { getBlogPosts } from '../../utils/blog';

// Define getStaticPaths to generate all possible blog post pages
export async function getStaticPaths() {
  const posts = await getBlogPosts();
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post }
  }));
}

// Get the current post from props
const { post } = Astro.props;

// If post doesn't exist, return 404
if (!post) {
  return Astro.redirect('/404');
}

// Get related posts
const relatedPosts = (await getBlogPosts())
  .filter(p => p.slug !== post.slug)
  .slice(0, 3);
---

<Layout title={`${post.title} | Taige's Blog`}>
  <!-- Header -->
  <section class="pt-32 pb-0">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <h1 class="text-4xl md:text-4xl font-bold mb-6 bg-gradient-to-r from-pink-400 to-orange-300 bg-clip-text text-transparent">
          {post.title}
        </h1>
        <div class="flex items-center gap-4 mb-2">
          <span class="inline-block px-3 py-1 text-sm font-semibold text-pink-400 bg-pink-400/10 rounded-full">
            {post.category}
          </span>
          <div class="flex items-center gap-6 text-gray-400 text-sm">
            <div class="flex items-center">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 mr-2"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                />
              </svg>
              {new Intl.DateTimeFormat('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              }).format(post.date)}
            </div>
            <div class="flex items-center">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-4 w-4 mr-2"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                />
              </svg>
              {post.author}
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Content -->
  <section class="pb-16">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        <article class="prose prose-invert prose-xl max-w-none prose-headings:font-bold prose-p:text-lg prose-li:text-lg">
          <div set:html={post.content} />
        </article>

        <!-- Tags -->
        {post.tags && post.tags.length > 0 && (
          <div class="mt-12 pt-8 border-t border-white/10">
            <h3 class="text-lg font-semibold mb-4">Tags</h3>
            <div class="flex flex-wrap gap-2">
              {post.tags.map((tag: string) => (
                <span class="px-3 py-1 text-sm bg-white/5 rounded-full text-gray-300">
                  #{tag}
                </span>
              ))}
            </div>
          </div>
        )}

        <!-- Related Posts -->
        {relatedPosts.length > 0 && (
          <div class="mt-12 pt-8 border-t border-white/10">
            <h3 class="text-lg font-semibold mb-6">Related Posts</h3>
            <div class="grid md:grid-cols-3 gap-6">
              {relatedPosts.map((relatedPost) => (
                <a
                  href={`/blogs/${relatedPost.slug}`}
                  class="group block bg-black/30 backdrop-blur-lg border border-white/10 rounded-lg overflow-hidden"
                >
                  <div class="p-4">
                    <h4 class="text-lg font-semibold mb-2 group-hover:text-pink-400 transition-colors">
                      {relatedPost.title}
                    </h4>
                    <p class="text-sm text-gray-400 line-clamp-2">
                      {relatedPost.description}
                    </p>
                  </div>
                </a>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>
  </section>
</Layout>

<style>
  /* Remove custom styles since we're using @tailwindcss/typography */
</style> 